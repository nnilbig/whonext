<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>活動報名</title>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        input, button { margin: 10px; padding: 8px; width: 80%; }
        table { width: 100%; margin-top: 20px; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 10px; text-align: left; }
    </style>
</head>
<body>
    <h2>活動報名</h2>
    <form id="signupForm">
        <input type="text" id="name" placeholder="姓名" required>
        <input type="text" id="note" placeholder="備註 (例如: 我只跟正妹打，謝謝)">
        <button type="submit">提交報名</button>
    </form>
    <p id="status"></p>

    <h2>報名名單</h2>
    <table>
        <thead>
            <tr><th>姓名</th><th>備註</th></tr>
        </thead>
        <tbody id="participants"></tbody>
    </table>

    <script>
        const LIFF_ID = "2006843080-qeWaGpZA";  // 修改為你的 LIFF ID
        const API_KEY = "AIzaSyDUwZDj2yjYQd3_Q53VyCXPRBBxthz0_I4";  // 修改為你的 Google Sheets API Key
        const SPREADSHEET_ID = "121VE_IpIOdySED21vF1at56qguIDBTHVRrqltG1MWog";  // 修改為你的 Google Sheets ID
        const RANGE = "報名名單!A:C";  // 設定存取範圍

        async function initLiff() {
            await liff.init({ liffId: LIFF_ID });

            if (liff.isLoggedIn()) {
                const profile = await liff.getProfile();
                document.getElementById("name").value = profile.displayName;
            } else {
                liff.login();
            }
        }

        function initGoogleSheetsAPI() {
            gapi.client.init({ apiKey: API_KEY, discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"] })
                .then(() => loadParticipants());
        }

        function loadParticipants() {
            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: SPREADSHEET_ID,
                range: RANGE
            }).then(response => {
                const rows = response.result.values || [];
                const tbody = document.getElementById("participants");
                tbody.innerHTML = "";
                rows.forEach(row => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `<td>${row[0]}</td><td>${row[1] || ""}</td>`;
                    tbody.appendChild(tr);
                });
            }).catch(error => {
                document.getElementById("status").innerText = "載入報名名單失敗";
                console.error(error);
            });
        }

        document.getElementById("signupForm").addEventListener("submit", async function(event) {
            event.preventDefault();
            const name = document.getElementById("name").value;
            const note = document.getElementById("note").value;
            const data = { values: [[name, note]] };

            document.getElementById("status").innerText = "提交中...";

            gapi.client.sheets.spreadsheets.values.append({
                spreadsheetId: SPREADSHEET_ID,
                range: RANGE,
                valueInputOption: "RAW",
                resource: data
            }).then(() => {
                document.getElementById("status").innerText = "報名成功！";
                loadParticipants();
            }).catch(error => {
                document.getElementById("status").innerText = "提交失敗";
                console.error(error);
            });
        });

        window.onload = function() {
            liff.init({ liffId: LIFF_ID }).then(() => initLiff());
            gapi.load("client", initGoogleSheetsAPI);
        };
    </script>
</body>
</html>

